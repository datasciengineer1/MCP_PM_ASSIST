"use strict";(()=>{var e={};e.id=4,e.ids=[4],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},11475:(e,t,n)=>{n.r(t),n.d(t,{originalPathname:()=>h,patchFetch:()=>w,requestAsyncStorage:()=>f,routeModule:()=>g,serverHooks:()=>A,staticGenerationAsyncStorage:()=>y});var a={};n.r(a),n.d(a,{POST:()=>l,dynamic:()=>u});var r=n(49303),s=n(88716),i=n(60670),o=n(87070),c=n(9487);let u="force-dynamic";async function l(e){try{let{projectId:t,agentType:n,input:a,streamResponse:r=!0}=await e.json();if(!t||!n)return o.NextResponse.json({error:"Project ID and agent type are required"},{status:400});let s=await c._.agent.findFirst({where:{type:n}});if(!s)return o.NextResponse.json({error:"Agent not found"},{status:404});if(r)return d(t,s,a);return p(t,s,a)}catch(e){return console.error("Agent analyze API error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}async function d(e,t,n){return new Response(new ReadableStream({async start(a){let r=new TextEncoder;try{let s=await c._.agentExecution.create({data:{agentId:t.id,projectId:e,status:"RUNNING",input:n,startedAt:new Date}});a.enqueue(r.encode(`data: ${JSON.stringify({status:"started",agent:t.type,executionId:s.id})}

`));let i=function(e){switch(e){case"INPUT_PARSER":return[{name:"text_extraction",description:"Extracting text content...",result:"Text extracted successfully"},{name:"data_parsing",description:"Parsing structured data...",result:"Data parsed and validated"},{name:"format_conversion",description:"Converting to standard format...",result:"Format conversion complete"}];case"PLANNING_AGENT":return[{name:"scope_analysis",description:"Analyzing project scope...",result:"Scope defined"},{name:"timeline_generation",description:"Creating project timeline...",result:"Timeline created"},{name:"resource_planning",description:"Planning resource allocation...",result:"Resources planned"}];case"RISK_ASSESSMENT":return[{name:"risk_identification",description:"Identifying potential risks...",result:"Risks identified"},{name:"impact_analysis",description:"Analyzing risk impact...",result:"Impact assessed"},{name:"mitigation_planning",description:"Planning mitigation strategies...",result:"Mitigation strategies defined"}];case"DOCUMENTATION":return[{name:"requirement_extraction",description:"Extracting requirements...",result:"Requirements extracted"},{name:"document_generation",description:"Generating documentation...",result:"Documents created"},{name:"template_application",description:"Applying templates...",result:"Templates applied"}];default:return[{name:"analysis",description:"Running analysis...",result:"Analysis complete"}]}}(t.type);for(let e=0;e<i.length;e++){let t=i[e];a.enqueue(r.encode(`data: ${JSON.stringify({status:"processing",step:t.name,progress:Math.round(e/i.length*100),message:t.description})}

`)),await new Promise(e=>setTimeout(e,1e3+2e3*Math.random())),a.enqueue(r.encode(`data: ${JSON.stringify({status:"step_completed",step:t.name,result:t.result})}

`))}let o=await m(t.type,e,n);await c._.agentExecution.update({where:{id:s.id},data:{status:"COMPLETED",output:o,completedAt:new Date}}),a.enqueue(r.encode(`data: ${JSON.stringify({status:"completed",result:o})}

`)),a.enqueue(r.encode("data: [DONE]\n\n"))}catch(t){let e=t instanceof Error?t.message:"Analysis failed";a.enqueue(r.encode(`data: ${JSON.stringify({status:"error",error:e})}

`))}finally{a.close()}}}),{headers:{"Content-Type":"text/plain; charset=utf-8","Cache-Control":"no-cache",Connection:"keep-alive"}})}async function p(e,t,n){let a=await c._.agentExecution.create({data:{agentId:t.id,projectId:e,status:"RUNNING",input:n,startedAt:new Date}});try{let r=await m(t.type,e,n);return await c._.agentExecution.update({where:{id:a.id},data:{status:"COMPLETED",output:r,completedAt:new Date}}),o.NextResponse.json({success:!0,executionId:a.id,result:r})}catch(e){throw await c._.agentExecution.update({where:{id:a.id},data:{status:"FAILED",errorMessage:e instanceof Error?e.message:"Unknown error",completedAt:new Date}}),e}}async function m(e,t,n){let a=await c._.project.findUnique({where:{id:t},include:{requirements:!0,tasks:!0,risks:!0}}),r=function(e,t,n){let a=`Project: ${t?.title||"Untitled"}
Description: ${t?.description||"No description"}
Status: ${t?.status||"Unknown"}`;switch(e){case"INPUT_PARSER":return[{role:"user",content:`As an Input Parser Agent, analyze and extract structured information from the following project input:

${a}

Input to parse: ${JSON.stringify(n)}

Provide a structured analysis of the input, identifying key project elements, requirements, tasks, and any actionable items.`}];case"PLANNING_AGENT":return[{role:"user",content:`As a Planning Agent, create a comprehensive project plan for:

${a}

Create a detailed timeline, identify key milestones, estimate effort, and suggest resource allocation. Consider dependencies and critical path.`}];case"RISK_ASSESSMENT":return[{role:"user",content:`As a Risk Assessment Agent, analyze potential risks for:

${a}

Identify technical, business, operational, and timeline risks. Assess probability and impact. Provide specific mitigation strategies for each risk.`}];case"DOCUMENTATION":return[{role:"user",content:`As a Documentation Agent, generate comprehensive project documentation for:

${a}

Create detailed requirements, technical specifications, and user stories. Format as professional project documentation.`}];default:return[{role:"user",content:`Analyze the following project and provide insights:

${a}`}]}}(e,a,n),s=process.env.ABACUSAI_API_KEY;if(!s)throw Error("ABACUSAI_API_KEY not configured");try{console.log(`Calling LLM API for agent ${e}`);let t=await fetch("https://apps.abacus.ai/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify({model:"gpt-4.1-mini",messages:r,max_tokens:2e3,temperature:.7})});if(!t.ok){let e=await t.text().catch(()=>"Unknown error");throw console.error(`LLM API Error ${t.status}:`,e),Error(`LLM API error: ${t.status} - ${e}`)}let n=await t.json(),i=n?.choices?.[0]?.message?.content??"No analysis generated";return{agent:e,analysis:i,timestamp:new Date,projectContext:{title:a?.title,status:a?.status,requirementsCount:a?.requirements?.length??0,tasksCount:a?.tasks?.length??0,risksCount:a?.risks?.length??0}}}catch(t){return console.error("LLM API call failed:",t),{agent:e,analysis:function(e,t){switch(e){case"INPUT_PARSER":return`Input Parser Analysis: Successfully processed project "${t?.title}". Identified ${t?.requirements?.length??0} requirements and ${t?.tasks?.length??0} tasks.`;case"PLANNING_AGENT":return`Planning Analysis: Created project plan for "${t?.title}". Estimated 12-16 weeks duration with 4 major phases: Planning, Design, Implementation, Testing.`;case"RISK_ASSESSMENT":return`Risk Assessment: Identified ${t?.risks?.length??0} risks for "${t?.title}". Primary risks include technical complexity, resource availability, and timeline constraints.`;case"DOCUMENTATION":return`Documentation Analysis: Generated comprehensive documentation for "${t?.title}". Includes requirements specification, technical architecture, and implementation guidelines.`;default:return`Analysis complete for project "${t?.title}". Status: ${t?.status}`}}(e,a),timestamp:new Date,fallback:!0,projectContext:{title:a?.title,status:a?.status}}}}let g=new r.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/agents/analyze/route",pathname:"/api/agents/analyze",filename:"route",bundlePath:"app/api/agents/analyze/route"},resolvedPagePath:"/Users/ravinangara/Documents/PMASSIST_MCP/pm_assistant_mvpf/app/app/api/agents/analyze/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:f,staticGenerationAsyncStorage:y,serverHooks:A}=g,h="/api/agents/analyze/route";function w(){return(0,i.patchFetch)({serverHooks:A,staticGenerationAsyncStorage:y})}},9487:(e,t,n)=>{n.d(t,{_:()=>r});var a=n(53524);let r=globalThis.prisma??new a.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),a=t.X(0,[276,972],()=>n(11475));module.exports=a})();