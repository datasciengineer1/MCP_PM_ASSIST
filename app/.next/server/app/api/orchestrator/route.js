"use strict";(()=>{var e={};e.id=127,e.ids=[127],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},40514:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>A,patchFetch:()=>w,requestAsyncStorage:()=>N,routeModule:()=>f,serverHooks:()=>I,staticGenerationAsyncStorage:()=>h});var a={};r.r(a),r.d(a,{POST:()=>l,dynamic:()=>u});var s=r(49303),i=r(88716),n=r(60670),o=r(87070),c=r(9487);let u="force-dynamic";async function l(e){try{let{projectId:t,workflow:r="full_analysis",input:a}=await e.json();if(!t)return o.NextResponse.json({error:"Project ID is required"},{status:400});let s=await c._.agent.findFirst({where:{type:"ORCHESTRATOR"}});if(!s)return o.NextResponse.json({error:"Orchestrator agent not found"},{status:404});let i=await c._.agentExecution.create({data:{agentId:s.id,projectId:t,status:"RUNNING",input:{workflow:r,input:a},startedAt:new Date}}),n=await p(t,r,a,i.id);return await c._.agentExecution.update({where:{id:i.id},data:{status:n.success?"COMPLETED":"FAILED",output:n,completedAt:new Date,errorMessage:n.success?null:"Workflow execution failed"}}),o.NextResponse.json({success:!0,executionId:i.id,workflow:n})}catch(e){return console.error("Orchestrator API error:",e),o.NextResponse.json({error:"Internal server error"},{status:500})}}async function p(e,t,r,a){try{let s={success:!0,workflow:t,projectId:e,executionId:a,steps:[],summary:{}},i=function(e){switch(e){case"full_analysis":return[{agent:"INPUT_PARSER",priority:1},{agent:"PLANNING_AGENT",priority:2},{agent:"RISK_ASSESSMENT",priority:3},{agent:"DOCUMENTATION",priority:4}];case"quick_parse":return[{agent:"INPUT_PARSER",priority:1}];case"risk_only":return[{agent:"INPUT_PARSER",priority:1},{agent:"RISK_ASSESSMENT",priority:2}];default:return[{agent:"INPUT_PARSER",priority:1},{agent:"PLANNING_AGENT",priority:2}]}}(t);for(let t of i)try{console.log(`Executing step: ${t.agent}`);let a=await d(e,t,r);s.steps.push({agent:t.agent,status:"completed",result:a,timestamp:new Date})}catch(e){console.error(`Step ${t.agent} failed:`,e),s.steps.push({agent:t.agent,status:"failed",error:e instanceof Error?e.message:"Unknown error",timestamp:new Date})}return s.summary={totalSteps:i.length,completedSteps:s.steps.filter(e=>"completed"===e.status).length,failedSteps:s.steps.filter(e=>"failed"===e.status).length,executionTime:new Date},s}catch(e){return{success:!1,error:e instanceof Error?e.message:"Workflow execution failed"}}}async function d(e,t,r){let a=await c._.agent.findFirst({where:{type:t.agent}});if(!a)throw Error(`Agent ${t.agent} not found`);let s=await c._.agentExecution.create({data:{agentId:a.id,projectId:e,status:"RUNNING",input:r,startedAt:new Date}}),i={};try{switch(t.agent){case"INPUT_PARSER":i=await m(e,r);break;case"PLANNING_AGENT":i=await g(e,r);break;case"RISK_ASSESSMENT":i=await y(e,r);break;case"DOCUMENTATION":i=await E(e,r);break;default:i={message:`Agent ${t.agent} executed successfully`}}return await c._.agentExecution.update({where:{id:s.id},data:{status:"COMPLETED",output:i,completedAt:new Date}}),i}catch(e){throw await c._.agentExecution.update({where:{id:s.id},data:{status:"FAILED",errorMessage:e instanceof Error?e.message:"Unknown error",completedAt:new Date}}),e}}async function m(e,t){return{agent:"INPUT_PARSER",processed:!0,extractedData:{projectTitle:t?.title||"Extracted Project",requirements:t?.requirements||[],tasks:t?.tasks||[]}}}async function g(e,t){let r=[{title:"Project Initialization",estimatedHours:8,priority:"HIGH"},{title:"Requirements Analysis",estimatedHours:16,priority:"HIGH"},{title:"System Design",estimatedHours:24,priority:"MEDIUM"},{title:"Implementation Phase 1",estimatedHours:40,priority:"MEDIUM"},{title:"Testing & QA",estimatedHours:16,priority:"HIGH"}];for(let t of r)await c._.task.create({data:{...t,projectId:e,description:`Auto-generated task: ${t.title}`,status:"TODO",dependencies:"",tags:""}});return{agent:"PLANNING_AGENT",tasksCreated:r.length,timeline:"3-4 months",phases:["Planning","Design","Development","Testing","Deployment"]}}async function y(e,t){let r=[{title:"Technical Complexity Risk",description:"High technical complexity may lead to delays",category:"TECHNICAL",probability:"MEDIUM",impact:"HIGH"},{title:"Resource Availability",description:"Key team members may not be available",category:"RESOURCE",probability:"LOW",impact:"MEDIUM"}];for(let t of r)await c._.risk.create({data:{...t,projectId:e,status:"IDENTIFIED"}});return{agent:"RISK_ASSESSMENT",risksIdentified:r.length,riskScore:"Medium",recommendations:["Conduct technical proof of concept","Establish resource backup plan"]}}async function E(e,t){let r=[{title:"User Authentication",description:"System must provide secure user authentication",category:"FUNCTIONAL",priority:"HIGH"},{title:"Data Security",description:"All data must be encrypted in transit and at rest",category:"NON_FUNCTIONAL",priority:"CRITICAL"}];for(let t of r)await c._.requirement.create({data:{...t,projectId:e,status:"DRAFT",tags:""}});return await c._.document.create({data:{projectId:e,title:"Project Requirements Document",content:"# Project Requirements\n\nThis document outlines the key requirements for the project...",docType:"REQUIREMENTS"}}),{agent:"DOCUMENTATION",requirementsCreated:r.length,documentsGenerated:1,documentTypes:["requirements"]}}let f=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/orchestrator/route",pathname:"/api/orchestrator",filename:"route",bundlePath:"app/api/orchestrator/route"},resolvedPagePath:"/Users/ravinangara/Documents/PMASSIST_MCP/pm_assistant_mvpf/app/app/api/orchestrator/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:N,staticGenerationAsyncStorage:h,serverHooks:I}=f,A="/api/orchestrator/route";function w(){return(0,n.patchFetch)({serverHooks:I,staticGenerationAsyncStorage:h})}},9487:(e,t,r)=>{r.d(t,{_:()=>s});var a=r(53524);let s=globalThis.prisma??new a.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972],()=>r(40514));module.exports=a})();